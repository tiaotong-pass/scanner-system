<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>條通祭店家登入</title>
    <style>
        /* --- 整體風格設定 (依照設計稿) --- */
        body {
            margin: 0; padding: 0;
            background-color: #F0F0F0; /* 米色背景 */
            font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh;
            border: 16px solid #231815; /* 深色邊框 */
            box-sizing: border-box;
        }

        /* --- Logo 區域 --- */
        #logo-container { margin-bottom: 40px; text-align: center; }
        #logo-img { width: 180px; height: auto; margin-bottom: 10px; }
        #logo-text { font-size: 14px; color: #59493F; letter-spacing: 1px; font-weight: bold; }

        /* --- 輸入框與按鈕 --- */
        .input-group {
            display: flex; flex-direction: column; gap: 20px;
            width: 80%; max-width: 320px;
        }

        /* 圓角輸入框 */
        #store-code {
            width: 100%; padding: 15px;
            border: none; border-radius: 50px;
            background-color: #FFFFFF;
            font-size: 18px; text-align: center; color: #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); outline: none;
        }
        #store-code::placeholder { color: #CECECE; }

        /* 綠色大按鈕 */
        #login-btn {
            width: 100%; padding: 15px;
            border: none; border-radius: 50px;
            background-color: #1B9A4B; /* 設計稿的綠色 */
            font-size: 20px; font-weight: bold; color: white;
            cursor: pointer; box-shadow: 0 4px 10px rgba(27, 154, 75, 0.3);
            transition: background-color 0.2s;
        }
        #login-btn:active { background-color: #147A3B; }

        /* --- 錯誤訊息 --- */
        #error-msg {
            margin-top: 25px;
            color: #C0392B; /* 設計稿的紅色 */
            font-weight: bold; font-size: 16px;
            display: none; /* 預設隱藏 */
            align-items: center; gap: 5px;
        }
        #error-msg::before { content: "✖"; font-size: 14px; }
    </style>
</head>
<body>
    <div id="logo-container">
        <img id="logo-img" src="img/logo.png" alt="TAIPEI TIAOTONG Logo" onerror="this.style.display='none';">
        <div id="logo-text">臺北市條通商圈產業發展促進會</div>
    </div>

    <div class="input-group">
        <input type="text" id="store-code" placeholder="請輸入店家密碼" inputmode="numeric">
        <button id="login-btn">登入熟客券系統</button>
    </div>

    <div id="error-msg">查無此碼或密碼錯誤</div>

    <script>
        let storeData = {};

        // 載入店家資料 (從 store_table.txt)
        fetch('store_table.txt')
            .then(res => res.json())
            .then(data => { storeData = data; })
            .catch(err => {
                console.error("無法載入店家名單:", err);
                alert("系統錯誤：無法載入店家名單，請聯繫管理員。");
            });

        const loginBtn = document.getElementById('login-btn');
        const codeInput = document.getElementById('store-code');
        const errorMsg = document.getElementById('error-msg');

        loginBtn.addEventListener('click', performLogin);
        codeInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') performLogin(); });

        function performLogin() {
            const inputCode = codeInput.value.trim();
            errorMsg.style.display = 'none'; // 先隱藏錯誤

            if (!storeData || Object.keys(storeData).length === 0) {
                alert("資料尚未載入完成，請稍後再試。");
                return;
            }

            // 比對密碼
            let foundStoreName = null;
            for (const [name, code] of Object.entries(storeData)) {
                if (code === inputCode) {
                    foundStoreName = name;
                    break;
                }
            }

            if (foundStoreName) {
                // 登入成功，儲存資訊並跳轉
                localStorage.setItem('storeName', foundStoreName);
                localStorage.setItem('storeIndex', inputCode); // 這裡用密碼當作索引
                location.href = 'store.html';
            } else {
                // 登入失敗，顯示錯誤訊息
                errorMsg.style.display = 'flex';
                codeInput.value = '';
                codeInput.focus();
            }
        }
    </script>
</body>
</html>
